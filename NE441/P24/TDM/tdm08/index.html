


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.12">
    
    
      
        <title>TDM08 - ESISAR -  NE441</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4dd2dd8d.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tdm08" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="ESISAR -  NE441" class="md-header-nav__button md-logo" aria-label="ESISAR -  NE441">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            ESISAR -  NE441
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              TDM08
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="ESISAR -  NE441" class="md-nav__button md-logo" aria-label="ESISAR -  NE441">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    ESISAR -  NE441
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../intro/index.html" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../exemples/index.html" title="Exemples du cours" class="md-nav__link">
      Exemples du cours
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../aidememoire/index.html" title="Aide mémoire Java" class="md-nav__link">
      Aide mémoire Java
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../outils/index.html" title="Aide Eclipse" class="md-nav__link">
      Aide Eclipse
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../rappel_reseau/index.html" title="Rappels réseau" class="md-nav__link">
      Rappels réseau
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../tdm01/index.html" title="TDM01" class="md-nav__link">
      TDM01
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../tdm02/index.html" title="TDM02" class="md-nav__link">
      TDM02
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../tdm03/index.html" title="TDM03" class="md-nav__link">
      TDM03
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../tdm04/index.html" title="TDM04" class="md-nav__link">
      TDM04
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../tdm05/index.html" title="TDM05" class="md-nav__link">
      TDM05
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../tdm06/index.html" title="TDM06" class="md-nav__link">
      TDM06
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        TDM08
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./index.html" title="TDM08" class="md-nav__link md-nav__link--active">
      TDM08
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-introduction" class="md-nav__link">
    1 Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-la-presentation-et-larchitecture-de-rmi" class="md-nav__link">
    2 La présentation et l'architecture de RMI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-les-differentes-etapes-pour-creer-un-objet-distant-et-lappeler-avec-rmi" class="md-nav__link">
    3 Les différentes étapes pour créer un objet distant et l'appeler avec RMI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-le-developpement-cote-serveur" class="md-nav__link">
    4 Le développement coté serveur
  </a>
  
    <nav class="md-nav" aria-label="4 Le développement coté serveur">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-la-definition-dune-interface-qui-contient-les-methodes-de-lobjet-distant" class="md-nav__link">
    4.1 La définition d'une interface qui contient les méthodes de l'objet distant
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-lecriture-dune-classe-qui-implemente-cette-interface" class="md-nav__link">
    4.2  L'écriture d'une classe qui implémente cette interface
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-lecriture-dune-classe-server" class="md-nav__link">
    4.3 L'écriture d'une classe Server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44-lecriture-dune-classe-registry" class="md-nav__link">
    4.4  L'écriture d'une classe Registry
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-le-developpement-cote-client" class="md-nav__link">
    5  Le développement coté client
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-details-sur-la-mise-en-oeuvre-des-objets-rmi" class="md-nav__link">
    6  Détails sur la mise en oeuvre des objets RMI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-exercice-1-rmi-lexemple-classique" class="md-nav__link">
    7  Exercice 1 – RMI , l'exemple classique
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-exercice-2-rmi-la-suite" class="md-nav__link">
    8  Exercice 2 – RMI, la suite
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercice-3-rmi-et-le-jeu-de-nim" class="md-nav__link">
    Exercice 3 – RMI et le jeu de Nim
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../tdm09/index.html" title="TDM09" class="md-nav__link">
      TDM09
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../tdm10/index.html" title="TDM10" class="md-nav__link">
      TDM10
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-introduction" class="md-nav__link">
    1 Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-la-presentation-et-larchitecture-de-rmi" class="md-nav__link">
    2 La présentation et l'architecture de RMI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-les-differentes-etapes-pour-creer-un-objet-distant-et-lappeler-avec-rmi" class="md-nav__link">
    3 Les différentes étapes pour créer un objet distant et l'appeler avec RMI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-le-developpement-cote-serveur" class="md-nav__link">
    4 Le développement coté serveur
  </a>
  
    <nav class="md-nav" aria-label="4 Le développement coté serveur">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-la-definition-dune-interface-qui-contient-les-methodes-de-lobjet-distant" class="md-nav__link">
    4.1 La définition d'une interface qui contient les méthodes de l'objet distant
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-lecriture-dune-classe-qui-implemente-cette-interface" class="md-nav__link">
    4.2  L'écriture d'une classe qui implémente cette interface
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-lecriture-dune-classe-server" class="md-nav__link">
    4.3 L'écriture d'une classe Server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44-lecriture-dune-classe-registry" class="md-nav__link">
    4.4  L'écriture d'une classe Registry
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-le-developpement-cote-client" class="md-nav__link">
    5  Le développement coté client
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-details-sur-la-mise-en-oeuvre-des-objets-rmi" class="md-nav__link">
    6  Détails sur la mise en oeuvre des objets RMI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-exercice-1-rmi-lexemple-classique" class="md-nav__link">
    7  Exercice 1 – RMI , l'exemple classique
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-exercice-2-rmi-la-suite" class="md-nav__link">
    8  Exercice 2 – RMI, la suite
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercice-3-rmi-et-le-jeu-de-nim" class="md-nav__link">
    Exercice 3 – RMI et le jeu de Nim
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <h1 id="tdm08">TDM08<a class="headerlink" href="#tdm08" title="Permanent link">&para;</a></h1>
<h2 id="1-introduction">1 Introduction<a class="headerlink" href="#1-introduction" title="Permanent link">&para;</a></h2>
<p>Ce TDM va permettre de découvrir JAVA RMI.</p>
<p>RMI (Remote Method Invocation) est une technologie développée et fournie par JAVA à partir du JDK 1.1 pour permettre de mettre en oeuvre facilement des objets distribués.</p>
<h2 id="2-la-presentation-et-larchitecture-de-rmi">2 La présentation et l'architecture de RMI<a class="headerlink" href="#2-la-presentation-et-larchitecture-de-rmi" title="Permanent link">&para;</a></h2>
<p>Le but de RMI est de permettre l'appel, l'exécution et le renvoi du résultat d'une méthode exécutée dans une machine virtuelle différente de celle de l'objet l'appelant. Cette machine virtuelle peut être sur une machine différente pourvu qu'elle soit accessible par le réseau.</p>
<p>La machine sur laquelle s'exécute la méthode distante est appelée serveur.</p>
<p>L'appel coté client d'une telle méthode est un peu plus compliqué que l'appel d'une méthode d'un objet local mais il reste simple. Il consiste à obtenir une référence sur l'objet distant puis à simplement appeler la méthode à partir de cette référence.</p>
<p>La technologie RMI se charge de rendre transparente la localisation de l'objet distant, son appel et le renvoi du résultat.</p>
<p>En fait, elle utilise deux classes particulières, le stub et le skeleton, qui sont générées dynamiquement par JAVA.</p>
<p>Le stub est une classe qui se situe côté client et le skeleton est son homologue coté serveur. Ces deux classes se chargent d'assurer tous les mécanismes d'appel, de communication, d'exécution, de renvoi et de réception du résultat.</p>
<p><img alt="Placeholder" src="a1.png" /></p>
<p>Il existe également un RMI Registery, qui mémorise la liste des serveurs offrant un service.</p>
<h2 id="3-les-differentes-etapes-pour-creer-un-objet-distant-et-lappeler-avec-rmi">3 Les différentes étapes pour créer un objet distant et l'appeler avec RMI<a class="headerlink" href="#3-les-differentes-etapes-pour-creer-un-objet-distant-et-lappeler-avec-rmi" title="Permanent link">&para;</a></h2>
<p>Le développement coté serveur se compose de :</p>
<ul>
<li>La définition d'une interface qui contient les méthodes qui peuvent être appelées à distance</li>
<li>L'écriture d'une classe qui implémente cette interface </li>
<li>L'écriture d'une classe qui instanciera l'objet et l'enregistrera en lui affectant un nom dans le registre de noms RMI (RMI Registry)</li>
</ul>
<p>Le coté serveur comprendra également le développement du RMI Registry.</p>
<p>Le développement côté client se compose de :</p>
<ul>
<li>L'obtention d'une référence sur l'objet distant à partir de son nom</li>
<li>L'appel à la méthode à partir de cette référence</li>
</ul>
<h2 id="4-le-developpement-cote-serveur">4 Le développement coté serveur<a class="headerlink" href="#4-le-developpement-cote-serveur" title="Permanent link">&para;</a></h2>
<h3 id="41-la-definition-dune-interface-qui-contient-les-methodes-de-lobjet-distant">4.1 La définition d'une interface qui contient les méthodes de l'objet distant<a class="headerlink" href="#41-la-definition-dune-interface-qui-contient-les-methodes-de-lobjet-distant" title="Permanent link">&para;</a></h3>
<p>L'interface à définir doit hériter de l'interface java.rmi.Remote. Cette interface ne contient aucune méthode mais indique simplement que l'interface peut être appelée à distance.</p>
<p>L'interface doit contenir toutes les méthodes qui seront susceptibles d'être appelées à distance.</p>
<p>La communication entre le client et le serveur lors de l'invocation de la méthode distante peut échouer pour diverses raisons telles qu'un crash du serveur, une rupture de la liaison, etc ...</p>
<p>Ainsi chaque méthode appelée à distance doit déclarer qu'elle est en mesure de lever l'exception java.rmi.RemoteException.</p>
<p>Exemple : </p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">java.rmi.Remote</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.rmi.RemoteException</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Calculette</span> <span class="kd">extends</span> <span class="n">Remote</span>
<span class="p">{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">somme</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">RemoteException</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="42-lecriture-dune-classe-qui-implemente-cette-interface">4.2  L'écriture d'une classe qui implémente cette interface<a class="headerlink" href="#42-lecriture-dune-classe-qui-implemente-cette-interface" title="Permanent link">&para;</a></h3>
<p>Cette classe correspond à l'objet distant. Elle doit donc implémenter l'interface définie et contenir le code nécessaire.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">java.rmi.RemoteException</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CalculetteImpl</span> <span class="kd">implements</span> <span class="n">Calculette</span>
<span class="p">{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">somme</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">RemoteException</span>
    <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Calcul de la somme de &quot;</span><span class="o">+</span><span class="n">a</span><span class="o">+</span><span class="s">&quot; et &quot;</span><span class="o">+</span><span class="n">b</span><span class="p">);</span>
        <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">c</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="43-lecriture-dune-classe-server">4.3 L'écriture d'une classe Server<a class="headerlink" href="#43-lecriture-dune-classe-server" title="Permanent link">&para;</a></h3>
<p>Cette classe Server va permettre d'instancier l'objet, de créer un serveur qui va attendre les demandes et de l'enregistrer dans le registre.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">java.rmi.AccessException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.rmi.AlreadyBoundException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.rmi.RemoteException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.rmi.registry.LocateRegistry</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.rmi.registry.Registry</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.rmi.server.UnicastRemoteObject</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CalculetteServer</span> 
<span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">AccessException</span><span class="p">,</span> <span class="n">RemoteException</span><span class="p">,</span> <span class="n">AlreadyBoundException</span>
    <span class="p">{</span>
        <span class="c1">// METTRE ICI L&#39;ADRESSE IP DE VOTRE SERVEUR </span>
        <span class="n">System</span><span class="p">.</span><span class="na">setProperty</span><span class="p">(</span><span class="s">&quot;java.rmi.server.hostname&quot;</span><span class="p">,</span> <span class="s">&quot;192.168.130.XXX&quot;</span><span class="p">);</span>  

        <span class="c1">// Crée un objet réel capable de faire des calculs </span>
        <span class="n">CalculetteImpl</span> <span class="n">calculetteImpl</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CalculetteImpl</span><span class="p">();</span>

        <span class="c1">// Crée un serveur ecoutant sur le port 7070, permettant d&#39;accéder à cet objet réel</span>
        <span class="n">Calculette</span> <span class="n">skeleton</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calculette</span><span class="p">)</span> <span class="n">UnicastRemoteObject</span><span class="p">.</span><span class="na">exportObject</span><span class="p">(</span><span class="n">calculetteImpl</span><span class="p">,</span><span class="mi">7070</span><span class="p">);</span>

        <span class="c1">//  Il y a un registry sur votre machine sur le port 5050</span>
        <span class="n">Registry</span> <span class="n">registry</span> <span class="o">=</span> <span class="n">LocateRegistry</span><span class="p">.</span><span class="na">getRegistry</span><span class="p">(</span><span class="s">&quot;127.0.0.1&quot;</span><span class="p">,</span><span class="mi">5050</span><span class="p">);</span>

        <span class="c1">// On indique au registry qu&#39;un service est présent sur notre machine, avec son nom </span>
        <span class="n">registry</span><span class="p">.</span><span class="na">bind</span><span class="p">(</span><span class="s">&quot;calculette&quot;</span><span class="p">,</span> <span class="n">skeleton</span><span class="p">);</span>

        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Le serveur est prêt ...&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="44-lecriture-dune-classe-registry">4.4  L'écriture d'une classe Registry<a class="headerlink" href="#44-lecriture-dune-classe-registry" title="Permanent link">&para;</a></h3>
<p>Cette classe va permettre de créer un service RMI Registry, écoutant sur le port 5050, et mémorisant la liste des serveurs qui offrent des services.</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">tp.tp5</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.rmi.AccessException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.rmi.AlreadyBoundException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.rmi.RemoteException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.rmi.registry.LocateRegistry</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.rmi.registry.Registry</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CreateRegistry</span> 
<span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">AccessException</span><span class="p">,</span> <span class="n">RemoteException</span><span class="p">,</span> <span class="n">AlreadyBoundException</span><span class="p">,</span> <span class="n">InterruptedException</span>
    <span class="p">{</span>
        <span class="c1">// Il y a un registry sur le port 5050</span>
        <span class="n">Registry</span> <span class="n">registry</span> <span class="o">=</span> <span class="n">LocateRegistry</span><span class="p">.</span><span class="na">createRegistry</span><span class="p">(</span><span class="mi">5050</span><span class="p">);</span>

        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Le registry est prêt ...&quot;</span><span class="p">);</span>

        <span class="c1">// Indispensable pour que le registry continue </span>
        <span class="k">while</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mi">100000</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>A noter : pour des raisons obscures, la classe CreateRegistry doit avoir dans son classpath (ou son projet) la classe Caculette. (voir le dernier post de 
<a href="http://stackoverflow.com/questions/27671325/why-does-simple-rmi-server-need-codebase">http://stackoverflow.com/questions/27671325/why-does-simple-rmi-server-need-codebase</a>
pour comprendre pourquoi en détail).</p>
<h2 id="5-le-developpement-cote-client">5  Le développement coté client<a class="headerlink" href="#5-le-developpement-cote-client" title="Permanent link">&para;</a></h2>
<p>Pour pouvoir utiliser les services proposés par CalculetteServer, il faut obtenir une référence sur l'objet distant à partir de son nom, et il est ensuite possible d'invoquer une méthode sur celui ci.</p>
<p>Voici un exemple : </p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">tp.tp5</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.rmi.AccessException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.rmi.AlreadyBoundException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.rmi.NotBoundException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.rmi.RemoteException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.rmi.registry.LocateRegistry</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.rmi.registry.Registry</span><span class="p">;</span>


<span class="cm">/**</span>
<span class="cm"> * Programme utilisant les services offerts par CalculetteServer</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UnProgrammeClient</span> 
<span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">AccessException</span><span class="p">,</span> <span class="n">RemoteException</span><span class="p">,</span> <span class="n">AlreadyBoundException</span><span class="p">,</span> <span class="n">NotBoundException</span>
    <span class="p">{</span>

        <span class="c1">// Il y a un registry sur le port 5050 sur votre machine</span>
        <span class="n">Registry</span> <span class="n">registry</span> <span class="o">=</span> <span class="n">LocateRegistry</span><span class="p">.</span><span class="na">getRegistry</span><span class="p">(</span><span class="s">&quot;127.0.0.1&quot;</span><span class="p">,</span><span class="mi">5050</span><span class="p">);</span>


        <span class="c1">// On récupére un stub qui nous permettra d&#39;accéder au service</span>
        <span class="n">Calculette</span> <span class="n">stub</span> <span class="o">=</span> <span class="p">(</span><span class="n">Calculette</span><span class="p">)</span> <span class="n">registry</span><span class="p">.</span><span class="na">lookup</span><span class="p">(</span><span class="s">&quot;calculette&quot;</span><span class="p">);</span>

        <span class="c1">// On va maintenant pourvoir s&#39;en servir pour faire un calcul </span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Début du programme client&quot;</span><span class="p">);</span>
        <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>

        <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="n">stub</span><span class="p">.</span><span class="na">somme</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>

        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Le resultat est &quot;</span><span class="o">+</span><span class="n">c</span><span class="p">);</span>


    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>A noter : </p>
<ul>
<li>L'objet retourné étant de type Remote, il faut réaliser un cast vers l'interface qui définit les méthodes de l'objet distant.</li>
<li>Un fois le cast réalisé, il suffit simplement d'appeler la méthode.</li>
</ul>
<h2 id="6-details-sur-la-mise-en-oeuvre-des-objets-rmi">6  Détails sur la mise en oeuvre des objets RMI<a class="headerlink" href="#6-details-sur-la-mise-en-oeuvre-des-objets-rmi" title="Permanent link">&para;</a></h2>
<p>La mise en oeuvre et l'utilisation d'objets distants avec RMI nécessite plusieurs étapes :</p>
<ul>
<li>Démarrer le registre RMI sur le serveur  en exécutant la classe qui effectue le lancement (dans notre exemple CreateRegistery)</li>
<li>Exécuter la classe qui instancie l'objet distant et l'enregistre dans le serveur de noms RMI (dans notre exemple la classe CalculetteServer)</li>
<li>Lancer l'application ou l'applet pour tester (dans notre exemple CalculetteClient)</li>
</ul>
<h2 id="7-exercice-1-rmi-lexemple-classique">7  Exercice 1 – RMI , l'exemple classique<a class="headerlink" href="#7-exercice-1-rmi-lexemple-classique" title="Permanent link">&para;</a></h2>
<p>Mettez en œuvre les explications précédentes :
+ faites un projet contenant les classes Calculette, CalculetteImpl, CreateRegistry, CalculetteServeur, CalculetteClient
+ lancer la classe  CreateRegistry
+ lancer la classe  CalculetteServeur
+ lancer la classe  CalculetteClient </p>
<p>Vérifiez le fonctionnement de l'ensemble. Analysez les flux réseaux avec Wireshark.</p>
<h2 id="8-exercice-2-rmi-la-suite">8  Exercice 2 – RMI, la suite<a class="headerlink" href="#8-exercice-2-rmi-la-suite" title="Permanent link">&para;</a></h2>
<p>Mettez vous par groupe de 2 binômes. Votre poste est client , le poste de l'autre binôme est serveur , faites fonctionner cette méthode somme à distance entre vos deux postes.</p>
<p>Analysez les flux réseaux avec Wireshark.</p>
<p>Ajoutez la méthode soustraction à l'interface Calculette. 
Votre poste est toujours client , le poste de l'autre binôme est toujours  serveur , faites fonctionner cette méthode soustraction à distance.</p>
<p>Analysez les flux réseaux avec Wireshark.</p>
<h2 id="exercice-3-rmi-et-le-jeu-de-nim">Exercice 3 – RMI et le jeu de Nim<a class="headerlink" href="#exercice-3-rmi-et-le-jeu-de-nim" title="Permanent link">&para;</a></h2>
<p>La version classique du jeu de Nim se joue avec plusieurs tas composés chacun de plusieurs jetons, ou pions, ou allumettes. </p>
<p>Chaque joueur à son tour peut enlever 1, 2 ou 3 pions, mais dans un seul tas à la fois. Le gagnant est celui qui retire le dernier pion.</p>
<p>Faites un jeu de Nim en réseau grâce à RMI. Pour chaque partie, vous aurez donc deux clients et un serveur (chaque client correspondant à un joueur).</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
      
    </div>
    
      <script src="../assets/javascripts/vendor.3636a4ec.min.js"></script>
      <script src="../assets/javascripts/bundle.e9fe3281.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: ["instant"],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.5eca75d3.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>